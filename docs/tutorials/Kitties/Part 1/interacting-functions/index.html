<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/substrate-how-to-guides/blog/rss.xml" title="Substrate How-to Guides Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/substrate-how-to-guides/blog/atom.xml" title="Substrate How-to Guides Blog Atom Feed"><title data-react-helmet="true">Interacting with your Kitties | Substrate How-to Guides</title><meta data-react-helmet="true" property="og:url" content="https://substrate-developer-hub.github.io/substrate-how-to-guides/docs/tutorials/Kitties/Part 1/interacting-functions"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Interacting with your Kitties | Substrate How-to Guides"><meta data-react-helmet="true" name="description" content="Add pallet capabilities that unleash the potential of your Substrate Kitty application."><meta data-react-helmet="true" property="og:description" content="Add pallet capabilities that unleash the potential of your Substrate Kitty application."><meta data-react-helmet="true" name="keywords" content="pallet design, intermediate, runtime"><link data-react-helmet="true" rel="shortcut icon" href="/substrate-how-to-guides/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://substrate-developer-hub.github.io/substrate-how-to-guides/docs/tutorials/Kitties/Part 1/interacting-functions"><link data-react-helmet="true" rel="alternate" href="https://substrate-developer-hub.github.io/substrate-how-to-guides/docs/tutorials/Kitties/Part 1/interacting-functions" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://substrate-developer-hub.github.io/substrate-how-to-guides/docs/tutorials/Kitties/Part 1/interacting-functions" hreflang="x-default"><link rel="stylesheet" href="/substrate-how-to-guides/assets/css/styles.ddf35dcd.css">
<link rel="preload" href="/substrate-how-to-guides/assets/js/styles.cd3fe465.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/runtime~main.fcd0997b.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/main.d946992c.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/1.6bfab5b7.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/2.e5cbf2fb.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/3.11a5035a.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/1be78505.50f91595.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/59.2fd5c4ab.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/935f2afb.93519677.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/57.573f0085.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/17896441.d3f8723f.js" as="script">
<link rel="preload" href="/substrate-how-to-guides/assets/js/c34f0897.a16bf841.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/substrate-how-to-guides/"><img src="/substrate-how-to-guides/img/substrate.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/substrate-how-to-guides/img/substrate.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Welcome</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/substrate-how-to-guides/docs/intro">How-to Guides</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/substrate-developer-hub/substrate-how-to-guides/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/substrate-how-to-guides/"><img src="/substrate-how-to-guides/img/substrate.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/substrate-how-to-guides/img/substrate.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Welcome</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/substrate-how-to-guides/docs/intro">How-to Guides</a></li><li class="menu__list-item"><a href="https://github.com/substrate-developer-hub/substrate-how-to-guides/" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/substrate-how-to-guides/docs/intro">Welcome</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/basics/basic-pallet-integration">Basic pallet integration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/basics/mint-token">Primitive token mint</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/basics/genesis-config-balances">Configuring genesis for Balances</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/basics/configurable-constants">Configure a runtime constant</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/basics/basic-tx-weight-calculations">Calculating transaction weights</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/basics/basic-instantiable-pallets">Basic instantiable pallets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/basics/helper-functions">Using helper functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/basics/publish-pallet">Publish a pallet to its own crate</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Pallet design</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/pallet-design/storage-value-struct">Create and use a struct in storage</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/pallet-design/simple-crowdfund">Simple crowdfund</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/pallet-design/lockable-currency">Simple staking pallet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/pallet-design/add-contracts-pallet">Use the Contracts pallet</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/pallet-design/randomness">Generating on-chain randomness</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/pallet-design/storage-map">Create and use a storage Map</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Weights</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/weights/conditional-weight-struct">Conditional weighting struct</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/weights/linear-weight-struct">Linear weighting struct</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/weights/quadratic-weight-struct">Quadratic weighting struct</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/weights/calculate-fees">Calculating fees</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Testing</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/testing/test-transfer">Testing a transfer function</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/testing/basic-pallet-testing">Setting up tests for your pallet</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Storage Migrations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/storage-migrations/nicks-migration">Basic storage migration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/storage-migrations/migration-steps-polkadotjs">Trigger a storage migration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/storage-migrations/migration-tests">Migration tests</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/storage-migrations/ringbuffer">Ringbuffer queue</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tools</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/tools/integrate-try-runtime">Include `try-runtime` in your project</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/tools/create-tx-wrapper-package">Create a `txwrapper` for a chain</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/tools/auction-winners-sidecar">Track Parachain auction winners using Substrate API Sidecar</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Consensus</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/consensus/pow-consensus">Configure a chain to POW consensus</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Parachains</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/parachains/overview">Parachains Guide Overview</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Collators</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/parachains/a-collators/start-collator-node">Start a collator node and add more collators</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Runtime Upgrades</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/parachains/b-runtime-upgrades/runtime-upgrades">Preparing for On-Chain Upgrades</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/parachains/b-runtime-upgrades/setup-runtime-and-client">Set-up your runtime and client</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/parachains/b-runtime-upgrades/upgrade-scheduler">How to use the scheduler pallet for storage migrations</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Registration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/parachains/c-registration/register-paraID">How to reserve a ParaID</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/parachains/c-registration/register-parachain">How to register your Parachain</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Other</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/parachains/e-other/start-testnet">Start a testnet on Rococo</a></li></ul></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Tutorials</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Kitties</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-how-to-guides/docs/tutorials/Kitties/overview">😺 Substrate Kitties</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">Part 1</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-how-to-guides/docs/tutorials/Kitties/Part 1/basic-setup">Basic set-up</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-how-to-guides/docs/tutorials/Kitties/Part 1/create-kitties">Uniqueness, custom types and storage maps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/substrate-how-to-guides/docs/tutorials/Kitties/Part 1/dispatchables-and-events">Dispatchables, Events and Errors</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/substrate-how-to-guides/docs/tutorials/Kitties/Part 1/interacting-functions">Interacting with your Kitties</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Part 2</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/tutorials/Kitties/Part 2/kitties-frontend-1">Kitty Front-end Outline</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/tutorials/Kitties/Part 2/kitties-frontend-2">Creating Custom Components</a></li></ul></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Want to Contribute?</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/substrate-how-to-guides/docs/contribute/how-to-template">How-to Template</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Interacting with your Kitties</h1></header><div class="markdown"><p><em>Add pallet capabilities that unleash the potential of your Substrate Kitty application.</em></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="overview"></a>Overview<a class="hash-link" href="#overview" title="Direct link to heading">#</a></h2><p>Up until this point in the tutorial, we&#x27;ve built a chain capable of only creating and tracking the ownership of Kitties. In this part of the tutorial, we want to make our runtime more
like a game by introducing other functions like buying and
selling Kitties. In order to achieve this, we&#x27;ll first need to enable users
to update the price of their Kitty. Then we can add functionality to enable users to transfer, buy and breed Kitties.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="learning-outcomes"></a>Learning outcomes<a class="hash-link" href="#learning-outcomes" title="Direct link to heading">#</a></h2><p>➡️ Learn how to create a dispatchable that updates an object in storage.</p><p>➡️ Getting a value from a struct in storage.</p><p>➡️ How to use the <code>transfer</code> from FRAME&#x27;s Currency trait.</p><p>➡️ How to write sanity check using <code>ensure!()</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="steps"></a>Steps<a class="hash-link" href="#steps" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="1-set-a-price-for-each-kitty"></a>1. Set a price for each Kitty<a class="hash-link" href="#1-set-a-price-for-each-kitty" title="Direct link to heading">#</a></h3><p>In <a href="https://github.com/substrate-developer-hub/substrate-how-to-guides/blob/main/static/code/kitties-tutorial/04-interacting-functions.rs" target="_blank" rel="noopener noreferrer">the helper file for this part of the tutorial</a>, you&#x27;ll notice that the structure of <code>set_price</code> is already laid out.</p><p>Your job is to replace ACTION lines #1, #2 and #3 lines with what you&#x27;ll learn in sections A-D below. </p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="a-checking-kitty-owner"></a>A. Checking Kitty owner<a class="hash-link" href="#a-checking-kitty-owner" title="Direct link to heading">#</a></h4><p>As we create functions which modify objects in storage, we
should always check that only the appropriate users are successful when calling those dispatchable functions.</p><p>The general pattern for an ownership check will look something like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">let owner = Self::owner_of(object_id).ok_or(&quot;No owner for this object&quot;)?;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ensure!(owner == sender, &quot;You are not the owner&quot;);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Your turn!</strong> Paste in this code snippet to replace ACTION #1:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">ensure!(Self::is_kitty_owner(&amp;kitty_id, &amp;sender)?, &lt;Error&lt;T&gt;&gt;::NotKittyOwner);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="b-updating-the-price-of-our-kitty-object"></a>B. Updating the price of our Kitty object<a class="hash-link" href="#b-updating-the-price-of-our-kitty-object" title="Direct link to heading">#</a></h4><p>Every Kitty object has a price attribute that we&#x27;ve set to [<code>None</code>] as a default value inside the
<code>mint</code> function in <a href="/substrate-how-to-guides/docs/tutorials/Kitties/Part 1/dispatchables-and-events#3-write-the-mint-function">Part II</a>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">let kitty = Kitty::&lt;T&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                dna: dna.unwrap_or_else(Self::gen_dna),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                price: None,                           //&lt;-- 👀 here</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                gender: gender.unwrap_or_else(Self::gen_gender),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                owner: owner.clone(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            };</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To update the price of a Kitty, we&#x27;ll need to:</p><ul><li>Get the Kitty object in storage.</li><li>Update the object with the new price.</li><li>Push it back into storage.</li></ul><p>Changing a value in an existing object in storage would be written in the following way:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">let mut object = Self::get_object(object_id);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">object.value = new_value;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;Object&lt;T&gt;&gt;::insert(object_id, object);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Rust expects you to declare a variable as mutable (using the <code>mut</code> keyword) whenever its value is going to be updated.</p></div></div><p><strong>Your turn!</strong> Paste in the following snippet to replace the ACTION #2 line: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kitty.price = new_price.clone();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;Kitties&lt;T&gt;&gt;::insert(&amp;kitty_id, kitty);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="d-deposit-an-event"></a>D. Deposit an event<a class="hash-link" href="#d-deposit-an-event" title="Direct link to heading">#</a></h4><p>Once all checks are passed and the new price is written to storage, we can deposit an event
<a href="/substrate-how-to-guides/docs/tutorials/Kitties/Part 1/dispatchables-and-events#4-implement-pallet-events">just like we did in Part III</a>.
Replace the line marked as ACTION #3 with:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Self::deposit_event(Event::PriceSet(sender, kitty_id, new_price));</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p> Now whenever the <code>set_price</code> dispatchable is called successfully, it will emit a <code>PriceSet</code> event. 🎉</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="2-transfer-a-kitty"></a>2. Transfer a Kitty<a class="hash-link" href="#2-transfer-a-kitty" title="Direct link to heading">#</a></h3><p>You already have the tools and knowledge you&#x27;ll need to create the transfer functionality from <a href="#1-set-a-price-for-each-kitty">step 1</a>. The main difference is that there are <strong>two parts</strong> to achieving this:</p><ol><li>A <strong>dispatchable function</strong> called <code>transfer()</code>: this is a publicly callable dispatchable exposed by your pallet.</li><li>A <strong>private function</strong> called <code>transfer_kitty_to()</code>: this will be a private helper function called by <code>transfer()</code> to handle all storage updates when transferring a Kitty.</li></ol><p>Separating the logic this way makes the private <code>transfer_kitty_to()</code> function reusable
by other dispatchable functions of our pallet, without needing to duplicate code. In our case, we&#x27;re going to reuse it for
the <code>buy_kitty</code> dispatchable we&#x27;re creating in the next section.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="transfer"></a><code>transfer</code><a class="hash-link" href="#transfer" title="Direct link to heading">#</a></h4><p>Paste in the following snippet to replace ACTION #5 in the template code:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[pallet::weight(100)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn transfer(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    origin: OriginFor&lt;T&gt;, </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    to: T::AccountId, </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    kitty_id: T::Hash</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; DispatchResult {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let from = ensure_signed(origin)?;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Ensure the kitty exists and is called by the kitty owner</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ensure!(Self::is_kitty_owner(&amp;kitty_id, &amp;from)?, &lt;Error&lt;T&gt;&gt;::NotKittyOwner);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Verify the kitty is not transferring back to its owner.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ensure!(from != to, &lt;Error&lt;T&gt;&gt;::TransferToSelf);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Verify the recipient has the capacity to receive one more kitty</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let to_owned = &lt;KittiesOwned&lt;T&gt;&gt;::get(&amp;to);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ensure!((to_owned.len() as u32) &lt; T::MaxKittyOwned::get(), &lt;Error&lt;T&gt;&gt;::ExceedMaxKittyOwned);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Self::transfer_kitty_to(&amp;kitty_id, &amp;to)?;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Self::deposit_event(Event::Transferred(from, to, kitty_id));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Ok(())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>By now the above pattern should be familiar. We always check that the transaction is signed; then we verify that the Kitty
being transfer is owned by the sender of this transaction; and last we call the <code>transfer_kitty_to</code> helper to update
all storage items appropriately.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="transfer_kitty_to"></a><code>transfer_kitty_to</code><a class="hash-link" href="#transfer_kitty_to" title="Direct link to heading">#</a></h4><p>Now, the <code>transfer_kitty_to</code> function will be a helper to perform all storage updates once a Kitty has been bought and sold.
All it needs to do is perform safety checks and update the following storage items:</p><ul><li><code>KittiesOwned</code>: to update the owner of the Kitty.</li><li><code>Kitties</code>: to reset the price in the Kitty object to None.</li></ul><p>Copy the following to replace ACTION #6:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[transactional]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub fn transfer_kitty_to(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    kitty_id: &amp;T::Hash,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    to: &amp;T::AccountId,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; Result&lt;(), Error&lt;T&gt;&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let mut kitty = Self::kitties(&amp;kitty_id).ok_or(&lt;Error&lt;T&gt;&gt;::KittyNotExist)?;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    let prev_owner = kitty.owner.clone();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Remove `kitty_id` from the KittyOwned vector of `prev_kitty_owner`</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;KittiesOwned&lt;T&gt;&gt;::try_mutate(&amp;prev_owner, |owned| {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if let Some(ind) = owned.iter().position(|&amp;id| id == *kitty_id) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            owned.swap_remove(ind);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return Ok(());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Err(())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }).map_err(|_| &lt;Error&lt;T&gt;&gt;::KittyNotExist)?;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Update the kitty owner</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    kitty.owner = to.clone();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Reset the ask price so the kitty is not for sale until `set_price()` is called</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // by the current owner.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    kitty.price = None;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;Kitties&lt;T&gt;&gt;::insert(kitty_id, kitty);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;KittiesOwned&lt;T&gt;&gt;::try_mutate(to, |vec| {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        vec.try_push(*kitty_id)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }).map_err(|_| &lt;Error&lt;T&gt;&gt;::ExceedMaxKittyOwned)?;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Ok(())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Notice the use of <a href="https://substrate.dev/rustdocs/latest/frame_support/attr.transactional.html" target="_blank" rel="noopener noreferrer"><code>[#transactional]</code></a> which we imported at the very beginning of this tutorial. It allows us to write dispatchable functions that will only write to storage at the same time as the helper functions it calls, making sure all storage writes happen together.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="3-buy-a-kitty"></a>3. Buy a Kitty<a class="hash-link" href="#3-buy-a-kitty" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="a-check-a-kitty-is-for-sale"></a>A. Check a Kitty is for Sale<a class="hash-link" href="#a-check-a-kitty-is-for-sale" title="Direct link to heading">#</a></h4><p>We&#x27;ll need to ensure 2 things before we can allow the user of this function to purchase a Kitty: first, check that the
Kitty is for sale; and second, check whether the Kitty&#x27;s current price is within the user&#x27;s budget and whether the user has
enough free balance.</p><p>Replace line ACTION #7:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Check the kitty is for sale and the kitty ask price &lt;= bid_price</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">if let Some(ask_price) = kitty.price {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ensure!(ask_price &lt;= bid_price, &lt;Error&lt;T&gt;&gt;::KittyBidPriceTooLow);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">} else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Err(&lt;Error&lt;T&gt;&gt;::KittyNotForSale)?;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Check the buyer has enough free balance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ensure!(T::Currency::free_balance(&amp;buyer) &gt;= bid_price, &lt;Error&lt;T&gt;&gt;::NotEnoughBalance);</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>In a similar vain, we have to verify whether the user has the capacity to receive a Kitty — remember we&#x27;re using
a <a href="https://substrate.dev/rustdocs/latest/frame_support/storage/bounded_vec/struct.BoundedVec.html" target="_blank" rel="noopener noreferrer"><code>BoundedVec</code></a> that can
only hold a fixed number of Kitties, defined in our pallet&#x27;s <code>MaxKittyOwned</code> constant.</p><p>One last check before we can allow this user to call this dispatchable (paste this in following the last snippet):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Verify the buyer has the capacity to receive one more kitty</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let to_owned = &lt;KittiesOwned&lt;T&gt;&gt;::get(&amp;buyer);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">ensure!((to_owned.len() as u32) &lt; T::MaxKittyOwned::get(), &lt;Error&lt;T&gt;&gt;::ExceedMaxKittyOwned);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">let seller = kitty.owner.clone();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="b-making-a-payment"></a>B. Making a Payment<a class="hash-link" href="#b-making-a-payment" title="Direct link to heading">#</a></h4><p>In <a href="#2-transfer-a-kitty">Step 2</a>, we added the functions necessary to transfer the <em>ownership</em> of our
Kitties. But we haven&#x27;t yet touched on the currrency associated to our pallet.
In this step we&#x27;ll learn how to use <a href="https://substrate.dev/rustdocs/latest/frame_support/traits/tokens/currency/index.html" target="_blank" rel="noopener noreferrer">FRAME&#x27;s Currency trait</a> to adjust account balances
using its very own <a href="https://crates.parity.io/frame_support/traits/tokens/currency/trait.Currency.html#tymethod.transfer" target="_blank" rel="noopener noreferrer"><code>transfer</code> method</a>. It&#x27;s useful to understand why it&#x27;s important to use the <code>transfer</code> method in particular and how we&#x27;ll be accessing it:</p><ul><li><p>The reason we&#x27;ll be using it is to ensure our runtime has the same understanding of currency throughout the pallets
it interacts with. The way that we ensure this is to use the <code>Currency</code> trait
from <code>frame_support</code>.</p></li><li><p>Conveniently, it handles a
<a href="https://substrate.dev/rustdocs/latest/frame_support/traits/tokens/currency/trait.Currency.html#associatedtype.Balance" target="_blank" rel="noopener noreferrer"><code>Balance</code></a> type, making it compatible with <code>BalanceOf</code> type we created for <code>kitty.price</code>. Take a look at how the <code>transfer</code>
function we&#x27;ll be using is structured (from the <a href="https://substrate.dev/rustdocs/latest/frame_support/traits/tokens/currency/trait.Currency.html#tymethod.transfer" target="_blank" rel="noopener noreferrer">Rust docs</a>):</p></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">fn transfer(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    source: &amp;AccountId,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    dest: &amp;AccountId,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    value: Self::Balance,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    existence_requirement: ExistenceRequirement</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">) -&gt; DispatchResult</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Now we can make use of the <code>Currency</code> type in our pallet&#x27;s <code>Config</code> trait and <code>ExistenceRequirement</code> – that we
<a href="/substrate-how-to-guides/docs/tutorials/Kitties/Part 1/basic-setup#2-write-out-pallet_kitties-scaffold">initially started with in Part I</a>.</p><p>Update the balances of both the caller of this function and the receiver, replacing ACTION #8:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Transfer the amount from buyer to seller</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">T::Currency::transfer(&amp;buyer, &amp;seller, bid_price, ExistenceRequirement::KeepAlive)?;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Transfer the kitty from seller to buyer</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Self::transfer_kitty_to(&amp;kitty_id, &amp;buyer)?;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Deposit relevant Event</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Self::deposit_event(Event::Bought(buyer, seller, kitty_id, bid_price));</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="4-breed-kitties"></a>4. Breed Kitties<a class="hash-link" href="#4-breed-kitties" title="Direct link to heading">#</a></h3><p>The logic behind breeding two Kitties is to multiply each corresponding DNA segment from two Kitties,
which will produce a new DNA sequence. Then, that DNA is used when minting a new Kitty. This helper function is already
provided for you in the template file for this section.</p><p>Paste in the following to complete the <code>breed_kitty</code> function, replacing line ACTION #10:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">let new_dna = Self::breed_dna(&amp;kid1, &amp;kid2)?;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Now that we&#x27;ve used the user inputs of Kitty IDs and combined them to create a new unique Kitty ID, we can
use the <code>mint()</code> function to write that new Kitty to storage. Replace line ACTION #11:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Self::mint(&amp;sender, Some(new_dna), None)?;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="5-genesis-configuration"></a>5. Genesis configuration<a class="hash-link" href="#5-genesis-configuration" title="Direct link to heading">#</a></h3><p>The final step before our pallet is ready to be used is to set the genesis state of our storage items. We&#x27;ll make use of
FRAME&#x27;s <code>[pallet::genesis_config]</code> to do this. Essentially, we&#x27;re declaring what the Kitties object in storage contains
in the genesis block. Copy the following code to replace ACTION #12: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Our pallet&#x27;s genesis configuration.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[pallet::genesis_config]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct GenesisConfig&lt;T: Config&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    pub kitties: Vec&lt;(T::AccountId, [u8; 16], Gender)&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Required to implement default for GenesisConfig.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[cfg(feature = &quot;std&quot;)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl&lt;T: Config&gt; Default for GenesisConfig&lt;T&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fn default() -&gt; GenesisConfig&lt;T&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        GenesisConfig { kitties: vec![] }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">#[pallet::genesis_build]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">impl&lt;T: Config&gt; GenesisBuild&lt;T&gt; for GenesisConfig&lt;T&gt; {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    fn build(&amp;self) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // When building a kitty from genesis config, we require the dna and gender to be supplied.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        for (acct, dna, gender) in &amp;self.kitties {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            let _ = &lt;Pallet&lt;T&gt;&gt;::mint(acct, Some(dna.clone()), Some(gender.clone()));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To let our chain know about our pallet&#x27;s genesis configuration, we need to modify the <code>chain_spec.rs</code> file in our project&#x27;s <code>node</code> folder. Go to <code>/node/src/chain_spec.rs</code> and add the following inside the <code>testnet_genesis</code> function:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly rust"><div tabindex="0" class="prism-code language-rust codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">//-- snip</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        kitties: KittiesConfig {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            kitties: vec![],</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">//-- snip</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="6-update-runtimesrclibrs-and-interact-with-your-kitties"></a>6. Update <code>runtime/src/lib.rs</code> and interact with your Kitties<a class="hash-link" href="#6-update-runtimesrclibrs-and-interact-with-your-kitties" title="Direct link to heading">#</a></h3><p>If you&#x27;ve completed all of the preceding parts and steps of this tutorial, you&#x27;re
all geared up to run your chain and start interacting with all the new capabilities of your Kitties pallet.</p><p>Build and run your chain using the following commands:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">cargo build --release</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">./target/release/node-kitties --dev --tmp</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Now check your work using the Polkadot-JS Apps UI just like <a href="/substrate-how-to-guides/docs/Tutorials/Kitties/Part 1/dispatchables-and-events#5-testing-with-polkadotjs-apps">we did in the previous part</a>. Once your chain is running and connected to the PolkadotJS Apps UI, perform these manual checks:</p><ul><li>Fund multiple users with tokens so they can all participate</li><li>Have each user create multiple Kitties</li><li>Try to transfer a Kitty from one user to another using the right and wrong owner</li><li>Try to set the price of a Kitty using the right and wrong owner</li><li>Buy a Kitty using an owner and another user</li><li>Use too little funds to purchase a Kitty</li><li>Overspend on the cost of the Kitty and ensure that the balance is reduced appropriately</li><li>Breed a Kitty and check that the new DNA is a mix of the old and new</li></ul><p>After all of these actions, confirm that all users have the right number of Kitties, the total Kitty count is correct, and any other storage variables are correctly represented</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Congratulations!</h5></div><div class="admonition-content"><p>You&#x27;ve successfully created the backend of a fully functional Substrate chain capable of creating and managing Substrate Kitties. It could also be abstracted to other NFT-like use cases. Most importantly, at this point in the tutorial you should have all the knowledge you need to start creating your own pallet logic and dispatchable functions.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="next-steps"></a>Next steps<a class="hash-link" href="#next-steps" title="Direct link to heading">#</a></h2><p>Complete Part II of this tutorial to:</p><ul><li>Connect your chain to the front-end template</li><li>Customize the template using PolkadotJS API</li><li>Interact with kitty avatars using a custom front-end React app</li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/substrate-developer-hub/substrate-how-to-guides/edit/main/docs/09-tutorials/01-Kitties/Part 1/interacting-functions.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/substrate-how-to-guides/docs/tutorials/Kitties/Part 1/dispatchables-and-events"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Dispatchables, Events and Errors</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/substrate-how-to-guides/docs/tutorials/Kitties/Part 2/kitties-frontend-1"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Kitty Front-end Outline »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link">Overview</a></li><li><a href="#learning-outcomes" class="table-of-contents__link">Learning outcomes</a></li><li><a href="#steps" class="table-of-contents__link">Steps</a><ul><li><a href="#1-set-a-price-for-each-kitty" class="table-of-contents__link">1. Set a price for each Kitty</a></li><li><a href="#2-transfer-a-kitty" class="table-of-contents__link">2. Transfer a Kitty</a></li><li><a href="#3-buy-a-kitty" class="table-of-contents__link">3. Buy a Kitty</a></li><li><a href="#4-breed-kitties" class="table-of-contents__link">4. Breed Kitties</a></li><li><a href="#5-genesis-configuration" class="table-of-contents__link">5. Genesis configuration</a></li><li><a href="#6-update-runtimesrclibrs-and-interact-with-your-kitties" class="table-of-contents__link">6. Update <code>runtime/src/lib.rs</code> and interact with your Kitties</a></li></ul></li><li><a href="#next-steps" class="table-of-contents__link">Next steps</a></li></ul></div></div></div><div><fieldset class="MuiBox-root jss39"><legend class="MuiTypography-root MuiTypography-body1">Was this guide useful?</legend><span class="MuiRating-root"><label class="MuiRating-label" for="customized-icons-1"><span class="MuiRating-icon MuiRating-iconFilled"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-6c-2.33 0-4.32 1.45-5.12 3.5h1.67c.69-1.19 1.97-2 3.45-2s2.75.81 3.45 2h1.67c-.8-2.05-2.79-3.5-5.12-3.5z"></path></svg></span><span class="MuiRating-visuallyhidden">Very Dissatisfied</span></label><input type="radio" value="1" id="customized-icons-1" name="customized-icons" class="MuiRating-visuallyhidden"><label class="MuiRating-label" for="customized-icons-2"><span class="MuiRating-icon MuiRating-iconFilled"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-3.5c.73 0 1.39.19 1.97.53.12-.14.86-.98 1.01-1.14-.85-.56-1.87-.89-2.98-.89-1.11 0-2.13.33-2.99.88.97 1.09.01.02 1.01 1.14.59-.33 1.25-.52 1.98-.52z"></path></svg></span><span class="MuiRating-visuallyhidden">Dissatisfied</span></label><input type="radio" value="2" id="customized-icons-2" name="customized-icons" checked="" class="MuiRating-visuallyhidden"><label class="MuiRating-label" for="customized-icons-3"><span class="MuiRating-icon MuiRating-iconEmpty"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm0-4c-.73 0-1.38-.18-1.96-.52-.12.14-.86.98-1.01 1.15.86.55 1.87.87 2.97.87 1.11 0 2.12-.33 2.98-.88-.97-1.09-.01-.02-1.01-1.15-.59.35-1.24.53-1.97.53z"></path></svg></span><span class="MuiRating-visuallyhidden">Neutral</span></label><input type="radio" value="3" id="customized-icons-3" name="customized-icons" class="MuiRating-visuallyhidden"><label class="MuiRating-label" for="customized-icons-4"><span class="MuiRating-icon MuiRating-iconEmpty"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M12 16c-1.48 0-2.75-.81-3.45-2H6.88c.8 2.05 2.79 3.5 5.12 3.5s4.32-1.45 5.12-3.5h-1.67c-.69 1.19-1.97 2-3.45 2zm-.01-14C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"></path></svg></span><span class="MuiRating-visuallyhidden">Satisfied</span></label><input type="radio" value="4" id="customized-icons-4" name="customized-icons" class="MuiRating-visuallyhidden"><label class="MuiRating-label" for="customized-icons-5"><span class="MuiRating-icon MuiRating-iconEmpty"><svg class="MuiSvgIcon-root" focusable="false" viewBox="0 0 24 24" aria-hidden="true"><circle cx="15.5" cy="9.5" r="1.5"></circle><circle cx="8.5" cy="9.5" r="1.5"></circle><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm-5-6c.78 2.34 2.72 4 5 4s4.22-1.66 5-4H7z"></path></svg></span><span class="MuiRating-visuallyhidden">Very Satisfied</span></label><input type="radio" value="5" id="customized-icons-5" name="customized-icons" class="MuiRating-visuallyhidden"></span></fieldset></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn Substrate</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/substrate-how-to-guides/docs/intro">How-to Guides</a></li><li class="footer__item"><a class="footer__link-item" href="/substrate-how-to-guides/docs/tutorials/kitties/overview">Tutorials</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">The Substrate How-to Guides are GPL 3.0 Licensed, open source and open for contributions.</div></div></div></footer></div>
<script src="/substrate-how-to-guides/assets/js/styles.cd3fe465.js"></script>
<script src="/substrate-how-to-guides/assets/js/runtime~main.fcd0997b.js"></script>
<script src="/substrate-how-to-guides/assets/js/main.d946992c.js"></script>
<script src="/substrate-how-to-guides/assets/js/1.6bfab5b7.js"></script>
<script src="/substrate-how-to-guides/assets/js/2.e5cbf2fb.js"></script>
<script src="/substrate-how-to-guides/assets/js/3.11a5035a.js"></script>
<script src="/substrate-how-to-guides/assets/js/1be78505.50f91595.js"></script>
<script src="/substrate-how-to-guides/assets/js/59.2fd5c4ab.js"></script>
<script src="/substrate-how-to-guides/assets/js/935f2afb.93519677.js"></script>
<script src="/substrate-how-to-guides/assets/js/57.573f0085.js"></script>
<script src="/substrate-how-to-guides/assets/js/17896441.d3f8723f.js"></script>
<script src="/substrate-how-to-guides/assets/js/c34f0897.a16bf841.js"></script>
</body>
</html>