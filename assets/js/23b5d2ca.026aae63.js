(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{188:function(e,t,n){"use strict";n.r(t),n.d(t,"MDXContext",(function(){return l})),n.d(t,"MDXProvider",(function(){return u})),n.d(t,"mdx",(function(){return g})),n.d(t,"useMDXComponents",(function(){return p})),n.d(t,"withMDXComponents",(function(){return m}));var a=n(0),i=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=i.a.createContext({}),m=function(e){return function(t){var n=p(t.components);return i.a.createElement(e,o({},t,{components:n}))}},p=function(e){var t=i.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},u=function(e){var t=p(e.components);return i.a.createElement(l.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},b=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,o=e.parentName,s=d(e,["components","mdxType","originalType","parentName"]),l=p(n),m=a,u=l["".concat(o,".").concat(m)]||l[m]||h[m]||r;return n?i.a.createElement(u,c(c({ref:t},s),{},{components:n})):i.a.createElement(u,c({ref:t},s))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=b;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var d=2;d<r;d++)o[d]=n[d];return i.a.createElement.apply(null,o)}return i.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"},45:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return l}));var a=n(3),i=n(8),r=(n(0),n(188)),o={sidebar_position:4,keywords:"pallet design, intermediate, runtime"},s={unversionedId:"tutorials/Kitties/Part 1/dispatchables-and-events",id:"tutorials/Kitties/Part 1/dispatchables-and-events",isDocsHomePage:!1,title:"Dispatchables, Events and Errors",description:"Write a dispatchable function that creates a Kitty capable of emitting its associated Event.",source:"@site/docs/09-tutorials/01-Kitties/Part 1/dispatchables-and-events.md",sourceDirName:"09-tutorials/01-Kitties/Part 1",slug:"/tutorials/Kitties/Part 1/dispatchables-and-events",permalink:"/substrate-how-to-guides/docs/tutorials/Kitties/Part 1/dispatchables-and-events",editUrl:"https://github.com/substrate-developer-hub/substrate-how-to-guides/edit/main/docs/09-tutorials/01-Kitties/Part 1/dispatchables-and-events.md",version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,keywords:"pallet design, intermediate, runtime"},sidebar:"tutorialSidebar",previous:{title:"Uniqueness, custom types and storage maps",permalink:"/substrate-how-to-guides/docs/tutorials/Kitties/Part 1/create-kitties"},next:{title:"Interacting with your Kitties",permalink:"/substrate-how-to-guides/docs/tutorials/Kitties/Part 1/interacting-functions"}},c=[{value:"Overview",id:"overview",children:[]},{value:"Learning outcomes",id:"learning-outcomes",children:[]},{value:"Steps",id:"steps",children:[{value:"1. Public and private functions",id:"1-public-and-private-functions",children:[]},{value:"2. Write the <code>create_kitty</code> dispatchable",id:"2-write-the-create_kitty-dispatchable",children:[]},{value:"3. Write the <code>mint()</code> function",id:"3-write-the-mint-function",children:[]},{value:"4. Implement pallet Events",id:"4-implement-pallet-events",children:[]},{value:"5. Error handling",id:"5-error-handling",children:[]},{value:"6. Testing with PolkadotJS Apps",id:"6-testing-with-polkadotjs-apps",children:[]}]},{value:"Next steps",id:"next-steps",children:[]}],d={toc:c};function l(e){var t=e.components,n=Object(i.default)(e,["components"]);return Object(r.mdx)("wrapper",Object(a.default)({},d,n,{components:t,mdxType:"MDXLayout"}),Object(r.mdx)("p",null,Object(r.mdx)("em",{parentName:"p"},"Write a dispatchable function that creates a Kitty capable of emitting its associated Event.")),Object(r.mdx)("h2",{id:"overview"},"Overview"),Object(r.mdx)("p",null,"In the previous section of this tutorial, we laid down the foundations geared to manage the ownership of our Kitties ","\u2014"," even though they don't really exist yet! In this part of the tutorial, we'll be putting these foundations to use\nby giving our pallet the ability to create a Kitty using the storage items we declared in the previous part. Breaking things down a little, we're going to:"),Object(r.mdx)("ul",null,Object(r.mdx)("li",{parentName:"ul"},Object(r.mdx)("strong",{parentName:"li"},"Write ",Object(r.mdx)("inlineCode",{parentName:"strong"},"create_kitty")),": a dispatchable or publicly callable function allowing an account to mint a Kitty."),Object(r.mdx)("li",{parentName:"ul"},Object(r.mdx)("strong",{parentName:"li"},"Write ",Object(r.mdx)("inlineCode",{parentName:"strong"},"mint()")),": a helper function that updates our pallet's storage items and performs error checks, called by ",Object(r.mdx)("inlineCode",{parentName:"li"},"create_kitty"),"."),Object(r.mdx)("li",{parentName:"ul"},Object(r.mdx)("strong",{parentName:"li"},"Include ",Object(r.mdx)("inlineCode",{parentName:"strong"},"Events")),": using FRAME's ",Object(r.mdx)("inlineCode",{parentName:"li"},"#[pallet::events]")," macro.")),Object(r.mdx)("p",null,"At the end of this part, we'll check that everything compiles without error and call our ",Object(r.mdx)("inlineCode",{parentName:"p"},"create_kitty")," extrinsic using the PolkadotJS Apps UI."),Object(r.mdx)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(r.mdx)("h5",{parentName:"div"},Object(r.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(r.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(r.mdx)("div",{parentName:"div",className:"admonition-content"},Object(r.mdx)("p",{parentName:"div"},'If you\'re feeling confident, you can continue building on your codebase from the previous part.\nIf you prefer using the "ACTION" items as a way to assist you through each step, replace the code from the\nPart II with ',Object(r.mdx)("a",{parentName:"p",href:"https://github.com/substrate-developer-hub/substrate-how-to-guides/blob/main/static/code/kitties-tutorial/03-dispatchables-and-events.rs"},"this part's helper code"),"."))),Object(r.mdx)("h2",{id:"learning-outcomes"},"Learning outcomes"),Object(r.mdx)("p",null,"\u27a1\ufe0f Write a dispatchable function that updates storage items using a helper function."),Object(r.mdx)("p",null,"\u27a1\ufe0f Write a private helper function with error handling"),Object(r.mdx)("p",null,"\u27a1\ufe0f Write and use pallet Events and Errors."),Object(r.mdx)("p",null,"\u27a1\ufe0f Use PolkadotJS Apps UI to test pallet functionality."),Object(r.mdx)("h2",{id:"steps"},"Steps"),Object(r.mdx)("h3",{id:"1-public-and-private-functions"},"1. Public and private functions"),Object(r.mdx)("p",null,"Before we dive right in, it's important to understand the pallet design decisions we'll be making around coding up our Kitty pallet's minting and ownership management\ncapabilities."),Object(r.mdx)("p",null,"As developers, we want to make sure the code we write is efficient and elegant. Oftentimes, optimizing for one optimizes for the other.\nThe way we're going to set up our pallet to optimize for both will be to break-up the \"heavy lifting\" dispatchable\nfunctions into private helper functions. This improves code readability and reusability too. As we'll see, we can\ncreate private functions which can be called by multiple dispatchable functions without compromizing on security. In fact, building this way can be considered an additive security feauture."),Object(r.mdx)("div",{className:"admonition admonition-info alert alert--info"},Object(r.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(r.mdx)("h5",{parentName:"div"},Object(r.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(r.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),Object(r.mdx)("div",{parentName:"div",className:"admonition-content"},Object(r.mdx)("p",{parentName:"div"},"Check out ",Object(r.mdx)("a",{parentName:"p",href:"/docs/basics/helper-functions/"},"this how-to guide")," about writing and using helper functions to learn more."))),Object(r.mdx)("p",null,"Before jumping into implementing this approach, let's first paint the big picture of what combining dispatchables and helper functions looks like:"),Object(r.mdx)("p",null,Object(r.mdx)("strong",{parentName:"p"},Object(r.mdx)("inlineCode",{parentName:"strong"},"create_kitty"))," (dispatchable function)"),Object(r.mdx)("ul",null,Object(r.mdx)("li",{parentName:"ul"},"check the origin is signed"),Object(r.mdx)("li",{parentName:"ul"},"generate a random hash with the signing account"),Object(r.mdx)("li",{parentName:"ul"},"create a new Kitty object using the random hash"),Object(r.mdx)("li",{parentName:"ul"},"call a private ",Object(r.mdx)("inlineCode",{parentName:"li"},"mint()")," function"),Object(r.mdx)("li",{parentName:"ul"},"increment the nonce using ",Object(r.mdx)("inlineCode",{parentName:"li"},"increment_nonce()")," from ",Object(r.mdx)("a",{parentName:"li",href:"/docs/tutorials/Kitties/Part%201/create-kitties#nonce"},"Part II"))),Object(r.mdx)("p",null,Object(r.mdx)("strong",{parentName:"p"},Object(r.mdx)("inlineCode",{parentName:"strong"},"mint"))," (private helper function)"),Object(r.mdx)("ul",null,Object(r.mdx)("li",{parentName:"ul"},"check that the Kitty doesn't already exist"),Object(r.mdx)("li",{parentName:"ul"},"update storage with the new Kitty ID (for all Kitties and for the owner's account)"),Object(r.mdx)("li",{parentName:"ul"},"update the new total Kitty count for storage and the new owner's account"),Object(r.mdx)("li",{parentName:"ul"},"deposit an Event to signal that a Kitty has succesfully been created")),Object(r.mdx)("h3",{id:"2-write-the-create_kitty-dispatchable"},"2. Write the ",Object(r.mdx)("inlineCode",{parentName:"h3"},"create_kitty")," dispatchable"),Object(r.mdx)("p",null,"A ",Object(r.mdx)("a",{parentName:"p",href:"https://substrate.dev/docs/en/knowledgebase/getting-started/glossary#dispatch"},"dispatchable")," in FRAME always follows the same structure. All pallet dispatchables live under the ",Object(r.mdx)("inlineCode",{parentName:"p"},"#[pallet::call]")," macro which requires declaring the dispatchables section with ",Object(r.mdx)("inlineCode",{parentName:"p"}," impl<T: Config> Pallet<T> {}"),". Read the\n",Object(r.mdx)("a",{parentName:"p",href:"https://substrate.dev/docs/en/knowledgebase/runtime/macros#palletcall"},"documentation")," on these FRAME macros to learn how they work. All we need to know here is that they're a useful feature of FRAME that minimizes the code required to write for pallets to be properly integrated in a Substrate chain's runtime."),Object(r.mdx)("h4",{id:"weights"},"Weights"),Object(r.mdx)("p",null,"As per the requirement for ",Object(r.mdx)("inlineCode",{parentName:"p"},"#[pallet::call]")," described in the its documentation, every dispatchable function must have an associated weight to it. Weights are\nan important part of developing with Substrate as they provide safe-guards around the amount of computation to fit in a block at execution time.\n",Object(r.mdx)("a",{parentName:"p",href:"https://substrate.dev/docs/en/knowledgebase/learn-substrate/weight"},"Substrate's weighting system")," forces developers to think about the computational complexity each ",Object(r.mdx)("a",{parentName:"p",href:"https://substrate.dev/docs/en/knowledgebase/runtime/execution#executing-extrinsics"},"extrinsic")," carries before it is called so that\na node will account for it's worst case, avoiding lagging the network with extrinsics that may take longer than the specified block time. Weights are also intimately linked to the ",Object(r.mdx)("a",{parentName:"p",href:"https://substrate.dev/docs/en/knowledgebase/runtime/fees"},"fee system")," for a signed extrinsic."),Object(r.mdx)("p",null,"For this simple application, we're going to default all weights to 100."),Object(r.mdx)("p",null,"Find ACTION #1 and replace it with the following code (we'll be compling it in the following section):"),Object(r.mdx)("pre",null,Object(r.mdx)("code",{parentName:"pre",className:"language-rust"},'    let sender = ensure_signed(origin)?;\n\n    let kitty_id = Self::mint(&sender, None, None)?;\n\n    // Logging to the console\n    log::info!("A kitty is born with ID: {:?}.", kitty_id);\n}\n')),Object(r.mdx)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(r.mdx)("h5",{parentName:"div"},Object(r.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(r.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),'Why "DispatchResult" and not "DispatchResultWithPostInfo" ?')),Object(r.mdx)("div",{parentName:"div",className:"admonition-content"},Object(r.mdx)("p",{parentName:"div"},"In ",Object(r.mdx)("inlineCode",{parentName:"p"},"create_kitty")," our return was of type ",Object(r.mdx)("inlineCode",{parentName:"p"},"DispatchResultWithPostInfo"),". Since ",Object(r.mdx)("inlineCode",{parentName:"p"},"mint()")," is a helper for ",Object(r.mdx)("inlineCode",{parentName:"p"},"create_kitty"),", we don't need to overwrite ",Object(r.mdx)("inlineCode",{parentName:"p"},"PostDispatchInfo"),",\nso we can use a return type of ",Object(r.mdx)("a",{parentName:"p",href:"https://substrate.dev/rustdocs/latest/frame_support/dispatch/type.DispatchResult.html"},Object(r.mdx)("inlineCode",{parentName:"a"},"DispatchResult"))," ","\u2014"," its unaugmented version."))),Object(r.mdx)("h3",{id:"3-write-the-mint-function"},"3. Write the ",Object(r.mdx)("inlineCode",{parentName:"h3"},"mint()")," function"),Object(r.mdx)("p",null,"As seen when we wrote ",Object(r.mdx)("inlineCode",{parentName:"p"},"create_kitty")," in the previous section, we'll need to create ",Object(r.mdx)("inlineCode",{parentName:"p"},"mint()")," for\nwriting our new unique Kitty object to the various storage items declared in Part II of this tutorial."),Object(r.mdx)("p",null,"Let's get right to it. Our ",Object(r.mdx)("inlineCode",{parentName:"p"},"mint()")," function will take the following arguments:"),Object(r.mdx)("ul",null,Object(r.mdx)("li",{parentName:"ul"},Object(r.mdx)("strong",{parentName:"li"},Object(r.mdx)("inlineCode",{parentName:"strong"},"to")),": of type ",Object(r.mdx)("inlineCode",{parentName:"li"},"&T::AccountId")),Object(r.mdx)("li",{parentName:"ul"},Object(r.mdx)("strong",{parentName:"li"},Object(r.mdx)("inlineCode",{parentName:"strong"},"dna")),": of type ",Object(r.mdx)("inlineCode",{parentName:"li"},"Option<[u8; 16]>")),Object(r.mdx)("li",{parentName:"ul"},Object(r.mdx)("strong",{parentName:"li"},Object(r.mdx)("inlineCode",{parentName:"strong"},"gender")),": of type ",Object(r.mdx)("inlineCode",{parentName:"li"},"Option<Gender>"))),Object(r.mdx)("p",null,"And it will return ",Object(r.mdx)("inlineCode",{parentName:"p"},"Result<T::Hash, Error<T>>"),"."),Object(r.mdx)("p",null,"Paste in the following code snippet to write the ",Object(r.mdx)("inlineCode",{parentName:"p"},"mint")," function, replacing ACTION #2 in the working codebase:"),Object(r.mdx)("pre",null,Object(r.mdx)("code",{parentName:"pre",className:"language-rust"},"// Helper to mint a Kitty.\npub fn mint(\n  owner: &T::AccountId,\n  dna: Option<[u8; 16]>,\n  gender: Option<Gender>,\n) -> Result<T::Hash, Error<T>> {\n  let kitty = Kitty::<T> {\n    dna: dna.unwrap_or_else(Self::gen_dna),\n    price: None,\n    gender: gender.unwrap_or_else(Self::gen_gender),\n    owner: owner.clone(),\n  };\n\n  let kitty_id = T::Hashing::hash_of(&kitty);\n\n  // Performs this operation first as it may fail\n  let new_cnt = Self::kitty_cnt().checked_add(1)\n    .ok_or(<Error<T>>::KittyCntOverflow)?;\n\n  // Performs this operation first because as it may fail\n  <KittiesOwned<T>>::try_mutate(&owner, |kitty_vec| {\n    kitty_vec.try_push(kitty_id)\n  }).map_err(|_| <Error<T>>::ExceedMaxKittyOwned)?;\n\n  <Kitties<T>>::insert(kitty_id, kitty);\n  <KittyCnt<T>>::put(new_cnt);\n  Ok(kitty_id)\n}\n")),Object(r.mdx)("p",null,"Let's go over what the above code is doing."),Object(r.mdx)("p",null,"The first thing we're doing is creating new values for a Kitty object. Then, we create a unique ",Object(r.mdx)("inlineCode",{parentName:"p"},"kitty_id")," using a hashing funciton on the adress of our Kitty object."),Object(r.mdx)("p",null,"Next, we increment the ",Object(r.mdx)("inlineCode",{parentName:"p"},"KittyCnt")," using its gett function, checking for overflow."),Object(r.mdx)("p",null,"Once we've done the check, we proceed with updating our storage items, making use of\nthe ",Object(r.mdx)("a",{parentName:"p",href:"https://substrate.dev/rustdocs/latest/frame_support/storage/trait.StorageMap.html#tymethod.try_mutate"},Object(r.mdx)("inlineCode",{parentName:"a"},"try_mutate"))," and ",Object(r.mdx)("a",{parentName:"p",href:"https://substrate.dev/rustdocs/latest/frame_support/storage/trait.StorageMap.html#tymethod.insert"},Object(r.mdx)("inlineCode",{parentName:"a"},"insert"))," methods from Substrate's StorageMap API and ",Object(r.mdx)("a",{parentName:"p",href:"https://substrate.dev/rustdocs/latest/frame_support/storage/trait.StorageValue.html#tymethod.put"},Object(r.mdx)("inlineCode",{parentName:"a"},"put"))," from ",Object(r.mdx)("inlineCode",{parentName:"p"},"StorageValue"),"."),Object(r.mdx)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(r.mdx)("h5",{parentName:"div"},Object(r.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(r.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"A quick recap of our storage items")),Object(r.mdx)("div",{parentName:"div",className:"admonition-content"},Object(r.mdx)("ul",{parentName:"div"},Object(r.mdx)("li",{parentName:"ul"},Object(r.mdx)("strong",{parentName:"li"},Object(r.mdx)("inlineCode",{parentName:"strong"},"<Kitties<T>>")),": Stores a Kitty's unique traits and price, by storing the Kitty object."),Object(r.mdx)("li",{parentName:"ul"},Object(r.mdx)("strong",{parentName:"li"},Object(r.mdx)("inlineCode",{parentName:"strong"},"<KittyOwned<T>>")),": Keeps track of what accounts own what Kitty."),Object(r.mdx)("li",{parentName:"ul"},Object(r.mdx)("strong",{parentName:"li"},Object(r.mdx)("inlineCode",{parentName:"strong"},"<KittyCnt<T>>")),": A count of all Kitties in existence.")))),Object(r.mdx)("h3",{id:"4-implement-pallet-events"},"4. Implement pallet Events"),Object(r.mdx)("p",null,"In Substrate, even though a transaction may be finalized, it does not necessarily imply that the function executed by that\ntransaction fully succeeded. To verify this, we make our pallet emit an ",Object(r.mdx)("a",{parentName:"p",href:"https://substrate.dev/docs/en/knowledgebase/runtime/events"},"Event"),' at the end of the function. This not only\nreports the success of a function\'s execution, but also tells the "off-chain world" that some particular state transition has happened.'),Object(r.mdx)("p",null,"FRAME helps us easily manage and declare our pallet's events using the ",Object(r.mdx)("a",{parentName:"p",href:"https://crates.parity.io/frame_support/attr.pallet.html#event-palletevent-optional"},Object(r.mdx)("inlineCode",{parentName:"a"},"#[pallet::event]"))," macro. With FRAME macros, events are just an enum declared like this:"),Object(r.mdx)("pre",null,Object(r.mdx)("code",{parentName:"pre",className:"language-rust"},"#[pallet::event]\n#[pallet::generate_deposit(pub(super) fn deposit_event)]\npub enum Event<T: Config>{\n    /// A function succeeded. [time, day]\n    Success(T::Time, T::Day),\n}\n")),Object(r.mdx)("p",null,"As you can see in the above snippet, we use:"),Object(r.mdx)("p",null,Object(r.mdx)("inlineCode",{parentName:"p"},"#[pallet::generate_deposit(pub(super) fn deposit_event)]")," "),Object(r.mdx)("p",null,"This allows us to deposit a specifc event using the pattern below:"),Object(r.mdx)("pre",null,Object(r.mdx)("code",{parentName:"pre",className:"language-rust"},"Self::deposit_event(Event::Success(var_time, var_day));\n")),Object(r.mdx)("p",null,"In order to use events inside our pallet, we need to have the ",Object(r.mdx)("inlineCode",{parentName:"p"},"Event")," type declared inside our pallet's configuration trait, ",Object(r.mdx)("inlineCode",{parentName:"p"},"Config"),". Additionally ","\u2014"," just as\nwhen adding any type to our pallet's ",Object(r.mdx)("inlineCode",{parentName:"p"},"Config")," trait ","\u2014"," we need to let our runtime know about it. "),Object(r.mdx)("p",null,"This pattern is the same as when\nwe added the ",Object(r.mdx)("inlineCode",{parentName:"p"},"KittyRandomness")," type in ",Object(r.mdx)("a",{parentName:"p",href:"/docs/Tutorials/Kitties/Part%201/create-kitties#3-implement-on-chain-randomness"},"Part II of this tutorial")," and has already been included from the initial scaffolding of our codebase: "),Object(r.mdx)("pre",null,Object(r.mdx)("code",{parentName:"pre",className:"language-rust"},"  /// Configure the pallet by specifying the parameters and types it depends on.\n  #[pallet::config]\n  pub trait Config: frame_system::Config {\n      /// Because this pallet emits events, it depends on the runtime's definition of an event.\n      type Event: From<Event<Self>> + IsType<<Self as frame_system::Config>::Event>;\n      //--snip--//\n  }\n")),Object(r.mdx)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(r.mdx)("h5",{parentName:"div"},Object(r.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(r.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Notice that each event deposit is meant to be informative which is why it carries the various types associated with it.")),Object(r.mdx)("div",{parentName:"div",className:"admonition-content"},Object(r.mdx)("p",{parentName:"div"},"It's good practice to get in the habit of documenting your event declarations so that your code is easy to read. It is convention to document events as such:"),Object(r.mdx)("p",{parentName:"div"},Object(r.mdx)("inlineCode",{parentName:"p"},"/// Description. [types]")),Object(r.mdx)("p",{parentName:"div"},"Learn more about events ",Object(r.mdx)("a",{parentName:"p",href:"https://substrate.dev/docs/en/knowledgebase/runtime/events"},"here"),"."))),Object(r.mdx)("p",null,"Declare your pallet events by replacing the ACTION #3 line with:"),Object(r.mdx)("pre",null,Object(r.mdx)("code",{parentName:"pre",className:"language-rust"},"  /// A new Kitty was sucessfully created. \\[sender, kitty_id\\]\n  Created(T::AccountId, T::Hash),\n  /// Kitty price was sucessfully set. \\[sender, kitty_id, new_price\\]\n  PriceSet(T::AccountId, T::Hash, Option<BalanceOf<T>>),\n  /// A Kitty was sucessfully transferred. \\[from, to, kitty_id\\]\n  Transferred(T::AccountId, T::AccountId, T::Hash),\n  /// A Kitty was sucessfully bought. \\[buyer, seller, kitty_id, bid_price\\]\n  Bought(T::AccountId, T::AccountId, T::Hash, BalanceOf<T>),\n")),Object(r.mdx)("p",null,"We'll be using most of these events in Part IV of this tutorial. For now let's use the relevant event for our ",Object(r.mdx)("inlineCode",{parentName:"p"},"create_kitty")," dispatchable."),Object(r.mdx)("p",null,"Complete it by replacing ACTION #4 with:"),Object(r.mdx)("pre",null,Object(r.mdx)("code",{parentName:"pre",className:"language-rust"},"Self::deposit_event(Event::Created(to, kitty_id));\n")),Object(r.mdx)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(r.mdx)("h5",{parentName:"div"},Object(r.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(r.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),Object(r.mdx)("div",{parentName:"div",className:"admonition-content"},Object(r.mdx)("p",{parentName:"div"},"If you're building your codebase from the previous part (and haven't been using the helper file for this part) you'll need to add ",Object(r.mdx)("inlineCode",{parentName:"p"},"Ok(())")," and properly close the ",Object(r.mdx)("inlineCode",{parentName:"p"},"create_kitty")," dispatchable."))),Object(r.mdx)("h3",{id:"5-error-handling"},"5. Error handling"),Object(r.mdx)("p",null,"FRAME provides us with an error handling system using ",Object(r.mdx)("a",{parentName:"p",href:"https://substrate.dev/docs/en/knowledgebase/runtime/errors"},Object(r.mdx)("inlineCode",{parentName:"a"},"[#pallet::errors]"))," which allows us to specify errors for our pallet and use them across our pallet's functions. "),Object(r.mdx)("p",null,"Declare all possible errors using the provided FRAME macro under ",Object(r.mdx)("inlineCode",{parentName:"p"},"#[pallet::error]")," (replace line ACTION #5a):"),Object(r.mdx)("pre",null,Object(r.mdx)("code",{parentName:"pre",className:"language-rust"},"        /// Handles arithemtic overflow when incrementing the Kitty counter.\n        KittyCntOverflow,\n        /// An account cannot own more Kitties than `MaxKittyCount`.\n        ExceedMaxKittyOwned,\n        /// Buyer cannot be the owner.\n        BuyerIsKittyOwner,\n        /// Cannot transfer a kitty to its owner.\n        TransferToSelf,\n        /// Handles checking whether the Kitty exists.\n        KittyNotExist,\n        /// Handles checking that the Kitty is owned by the account transferring, buying or setting a price for it.\n        NotKittyOwner,\n        /// Ensures the Kitty is for sale.\n        KittyNotForSale,\n        /// Ensures that the buying price is greater than the asking price.\n        KittyBidPriceTooLow,\n        /// Ensures that an account has enough funds to purchase a Kitty. \n        NotEnoughBalance,\n")),Object(r.mdx)("p",null,"We'll be using these errors once we write the interactive functions in the next section. Notice that we've already used ",Object(r.mdx)("inlineCode",{parentName:"p"},"KittyCntOverflow")," and ",Object(r.mdx)("inlineCode",{parentName:"p"},"ExceedMaxKittyOwned")," in our ",Object(r.mdx)("inlineCode",{parentName:"p"},"mint")," function."),Object(r.mdx)("p",null,"Now's a good time to see if your chain can compile. Instead of only checking if your pallet compiles, run the following command to see if everything can build:"),Object(r.mdx)("pre",null,Object(r.mdx)("code",{parentName:"pre",className:"language-rust"},"cargo +nightly build --release\n")),Object(r.mdx)("div",{className:"admonition admonition-tip alert alert--success"},Object(r.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(r.mdx)("h5",{parentName:"div"},Object(r.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(r.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(r.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),Object(r.mdx)("div",{parentName:"div",className:"admonition-content"},Object(r.mdx)("p",{parentName:"div"},"If you ran into errors, scroll to the first error message in your terminal, identify what line\nis giving an error and check whether you've\nfollowed each step correctly. Sometimes a mismatch of curly brackets will unleash a whole bunch\nof errors that are difficult to understand ","\u2014"," double check your code!"))),Object(r.mdx)("p",null,"Did that build fine? Congratulations! That's the core functionality of our Kitties pallet. In the next step you'll be able to\nsee everything you've built so far in action."),Object(r.mdx)("h3",{id:"6-testing-with-polkadotjs-apps"},"6. Testing with PolkadotJS Apps"),Object(r.mdx)("p",null,"Assuming that you successfully built your chain, let's run it and use the ",Object(r.mdx)("a",{parentName:"p",href:"https://polkadot.js.org/apps/#/explorer"},"PolkadotJS Apps UI")," to interact with it."),Object(r.mdx)("p",null,"In your chain's project directory, run:"),Object(r.mdx)("pre",null,Object(r.mdx)("code",{parentName:"pre",className:"language-bash"},"./target/release/node-kitties --tmp --dev\n")),Object(r.mdx)("p",null,"By doing this, we're specifying to run a temporary chain in developer mode, so as not to need to purge storage each time we want to start a fresh chain."),Object(r.mdx)("p",null,"Assuming that blocks are being finalized (which you should be able to see from your terminal in which you ran the above command), head over to ",Object(r.mdx)("a",{parentName:"p",href:"https://polkadot.js.org/apps/#/explorer"},"Poladot.js Apps"),"."),Object(r.mdx)("p",null,Object(r.mdx)("strong",{parentName:"p"},"Follow these steps:")),Object(r.mdx)("ol",null,Object(r.mdx)("li",{parentName:"ol"},'Check that you\'re connected to Local Node, under "Development". Your node will default to ',Object(r.mdx)("inlineCode",{parentName:"li"},"127.0.0.1.:9944"),"."),Object(r.mdx)("li",{parentName:"ol"},'Tell the UI about your custom types.\nThis requires you to paste them into the "',Object(r.mdx)("em",{parentName:"li"},"Settings"),'" -> "',Object(r.mdx)("em",{parentName:"li"},"Developers"),'" section.'),Object(r.mdx)("li",{parentName:"ol"},'Go to "',Object(r.mdx)("em",{parentName:"li"},"Developer"),'" -> "',Object(r.mdx)("em",{parentName:"li"},"Extrinsics"),'". Paste this in the JSON code editor:')),Object(r.mdx)("pre",null,Object(r.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "Gender": {\n    "_enum": [ "Male", "Female"]\n  },\n  "Kitty": {\n    "dna": "[u8; 16]",\n    "price": "Option<Balance>",\n    "gender": "Gender",\n    "ownder": "AccountId"\n  }\n}\n')),Object(r.mdx)("blockquote",null,Object(r.mdx)("p",{parentName:"blockquote"},"The reason we need this is because we created types that PolkadotJS Apps isn't designed to read custom types by default. By adding them, it can\nproperly decode each of our storage items that rely on custom types. Add this in a file caleld ",Object(r.mdx)("inlineCode",{parentName:"p"},"types.json")," in your projects ",Object(r.mdx)("inlineCode",{parentName:"p"},"runtime")," folder.")),Object(r.mdx)("ol",{start:3},Object(r.mdx)("li",{parentName:"ol"},"Now go to: ",Object(r.mdx)("em",{parentName:"li"},'"Developer"')," -> ",Object(r.mdx)("em",{parentName:"li"},'"Extrinsics"')," and submit a signed extrinsic using ",Object(r.mdx)("em",{parentName:"li"},"substrateKitties")," by calling the ",Object(r.mdx)("inlineCode",{parentName:"li"},"createKitty()")," dispatchable. Make 3 different transactions from Alice, Bob and Charlie's accounts"),Object(r.mdx)("li",{parentName:"ol"},"Check for the associated event ",Object(r.mdx)("em",{parentName:"li"},'"Created"'),' by going to "',Object(r.mdx)("em",{parentName:"li"},"Network"),'" -> "',Object(r.mdx)("em",{parentName:"li"},"Explorer"),'". You should be able to see the event emitted and query its block details.'),Object(r.mdx)("li",{parentName:"ol"},"Check your newly created Kitty's details by going to \"",Object(r.mdx)("em",{parentName:"li"},"Developer"),'" -> "',Object(r.mdx)("em",{parentName:"li"},"Chain State"),'". Select the ',Object(r.mdx)("em",{parentName:"li"},"substrateKitties")," pallet and query ",Object(r.mdx)("inlineCode",{parentName:"li"},"Kitties(Hash): Kitty"),". ",Object(r.mdx)("strong",{parentName:"li"},"Note:")," You'll notice that this is actually querying all of your pallet's storage items!")),Object(r.mdx)("p",null,'Be sure to uncheck the "include option" box and you should be able to see the details of your newly minted Kitty in the following format:'),Object(r.mdx)("pre",null,Object(r.mdx)("code",{parentName:"pre",className:"language-json"},"kitties.kitties: Option<Kitty>\n[\n  [\n    [\n      0x15cb95604033af239640125a30c45b671a282f3ef42c6fc48a78eb18464b30a9\n    ],\n    {\n      dna: 0xaf2f2b3f77e110a56933903a38cde1eb,\n      price: null,\n      gender: Female,\n      ownder: 5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY\n    }\n  ]\n]\n")),Object(r.mdx)("ol",{start:5},Object(r.mdx)("li",{parentName:"ol"},"Check that other storage items correctly reflect the creation of additional Kitties.")),Object(r.mdx)("div",{className:"admonition admonition-note alert alert--secondary"},Object(r.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(r.mdx)("h5",{parentName:"div"},Object(r.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(r.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(r.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Congratulations!")),Object(r.mdx)("div",{parentName:"div",className:"admonition-content"},Object(r.mdx)("p",{parentName:"div"},"You're pretty much able to take it from here at this point! We've learnt how to implement the key parts of what powers a FRAME pallet and how to put them to use. All part IV of this tutorial covers is adding more capabilities to our pallet by taking what we've learnt in this part."),Object(r.mdx)("p",{parentName:"div"},"To recap, in this part of the tutorial you've learnt how to:"),Object(r.mdx)("ul",{parentName:"div"},Object(r.mdx)("li",{parentName:"ul"},"Distinguish between implementing a dispatchable function and a private helper function."),Object(r.mdx)("li",{parentName:"ul"},"Use ",Object(r.mdx)("inlineCode",{parentName:"li"},"#[pallet::call]"),", ",Object(r.mdx)("inlineCode",{parentName:"li"},"#[pallet::events]")," and ",Object(r.mdx)("inlineCode",{parentName:"li"},"#[pallet::error]"),"."),Object(r.mdx)("li",{parentName:"ul"},"Implement basic error checking with FRAME."),Object(r.mdx)("li",{parentName:"ul"},"Update values in storage with safety checks."),Object(r.mdx)("li",{parentName:"ul"},"Implement FRAME events and use them in a function."),Object(r.mdx)("li",{parentName:"ul"},"Query storage items and chain state using the PolkadotJS Apps UI.")))),Object(r.mdx)("h2",{id:"next-steps"},"Next steps"),Object(r.mdx)("ul",null,Object(r.mdx)("li",{parentName:"ul"},"Create a dispatchable to buy a Kitty"),Object(r.mdx)("li",{parentName:"ul"},"Create a dispatchable to transfer a Kitty"),Object(r.mdx)("li",{parentName:"ul"},"Create a dispatchable to breed two Kitties")))}l.isMDXComponent=!0}}]);