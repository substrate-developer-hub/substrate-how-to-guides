(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{188:function(e,t,n){"use strict";n.r(t),n.d(t,"MDXContext",(function(){return u})),n.d(t,"MDXProvider",(function(){return p})),n.d(t,"mdx",(function(){return h})),n.d(t,"useMDXComponents",(function(){return m})),n.d(t,"withMDXComponents",(function(){return d}));var a=n(0),r=n.n(a);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var u=r.a.createContext({}),d=function(e){return function(t){var n=m(t.components);return r.a.createElement(e,o({},t,{components:n}))}},m=function(e){var t=r.a.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=m(e.components);return r.a.createElement(u.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},f=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,o=e.parentName,i=c(e,["components","mdxType","originalType","parentName"]),u=m(n),d=a,p=u["".concat(o,".").concat(d)]||u[d]||b[d]||l;return n?r.a.createElement(p,s(s({ref:t},i),{},{components:n})):r.a.createElement(p,s({ref:t},i))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,o=new Array(l);o[0]=f;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var c=2;c<l;c++)o[c]=n[c];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}f.displayName="MDXCreateElement"},52:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return i})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return u}));var a=n(3),r=n(8),l=(n(0),n(188)),o={sidebar_position:4,keywords:"basics, runtime"},i={unversionedId:"basics/configurable-constants",id:"basics/configurable-constants",isDocsHomePage:!1,title:"Configure a runtime constant",description:"The basics for defining a constant in your runtime.",source:"@site/docs/01-basics/configurable-constants.md",sourceDirName:"01-basics",slug:"/basics/configurable-constants",permalink:"/substrate-how-to-guides/docs/basics/configurable-constants",editUrl:"https://github.com/substrate-developer-hub/substrate-how-to-guides/edit/main/docs/01-basics/configurable-constants.md",version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,keywords:"basics, runtime"},sidebar:"tutorialSidebar",previous:{title:"Configuring genesis for Balances",permalink:"/substrate-how-to-guides/docs/basics/genesis-config-balances"},next:{title:"Calculating transaction weights",permalink:"/substrate-how-to-guides/docs/basics/basic-tx-weight-calculations"}},s=[{value:"Goal",id:"goal",children:[]},{value:"Use cases",id:"use-cases",children:[]},{value:"Overview",id:"overview",children:[]},{value:"Steps",id:"steps",children:[{value:"1. Define the constants in your pallet",id:"1-define-the-constants-in-your-pallet",children:[]},{value:"2. Declare your storage items and events",id:"2-declare-your-storage-items-and-events",children:[]},{value:"3. Configure <code>on_finalize</code>",id:"3-configure-on_finalize",children:[]},{value:"4. Create a method that allows users to specify the value",id:"4-create-a-method-that-allows-users-to-specify-the-value",children:[]},{value:"5. Supply the constant value for runtime",id:"5-supply-the-constant-value-for-runtime",children:[]}]},{value:"Examples",id:"examples",children:[]},{value:"Resources",id:"resources",children:[]}],c={toc:s};function u(e){var t=e.components,n=Object(r.default)(e,["components"]);return Object(l.mdx)("wrapper",Object(a.default)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(l.mdx)("p",null,Object(l.mdx)("em",{parentName:"p"},"The basics for defining a constant in your runtime.")),Object(l.mdx)("h2",{id:"goal"},"Goal"),Object(l.mdx)("p",null,"Define a runtime constant value that becomes reset on ",Object(l.mdx)("inlineCode",{parentName:"p"},"on_finalize"),"."),Object(l.mdx)("h2",{id:"use-cases"},"Use cases"),Object(l.mdx)("p",null,"Use a constant to keep track of the amount of times a function is called during a single block cycle."),Object(l.mdx)("h2",{id:"overview"},"Overview"),Object(l.mdx)("p",null,"Declaring a constant value in a runtime is a useful tool to either define fixed values or define values that change dynamically\naccording to some factor. This guide steps through the process of creating pallet constants that are used to reset a ",Object(l.mdx)("inlineCode",{parentName:"p"},"u32"),"\nvalue in storage. This value, we'll call ",Object(l.mdx)("inlineCode",{parentName:"p"},"SingleValue"),", can also be modified using a method called ",Object(l.mdx)("inlineCode",{parentName:"p"},"add_value"),"."),Object(l.mdx)("p",null,"The purpose of this guide is to demonstrate the utiltiy of configuring constants by hardcoding them as well as making them more\ndynamic."),Object(l.mdx)("h2",{id:"steps"},"Steps"),Object(l.mdx)("h3",{id:"1-define-the-constants-in-your-pallet"},"1. Define the constants in your pallet"),Object(l.mdx)("ul",null,Object(l.mdx)("li",{parentName:"ul"},Object(l.mdx)("inlineCode",{parentName:"li"},"MaxAddend")," will be the value displayed in metadata."),Object(l.mdx)("li",{parentName:"ul"},Object(l.mdx)("inlineCode",{parentName:"li"},"ClearFrequency")," keeps track of the block numbers and will\nbe used to reset ",Object(l.mdx)("inlineCode",{parentName:"li"},"SingleValue"),":")),Object(l.mdx)("pre",null,Object(l.mdx)("code",{parentName:"pre",className:"language-rust"},"#[pallet::config]\n    pub trait Config: frame_system::Config {\n        type Event: From<Event<Self>> + IsType<<Self as frame_system::Config>::Event>;\n\n        #[pallet::constant] // put the constant in metadata\n        /// Maximum amount added per invocation.\n        type MaxAddend: Get<u32>;\n\n        /// Frequency with which the stored value is deleted.\n        type ClearFrequency: Get<Self::BlockNumber>;\n    }\n")),Object(l.mdx)("h3",{id:"2-declare-your-storage-items-and-events"},"2. Declare your storage items and events"),Object(l.mdx)("p",null,"Using the storage attribute macro, declare ",Object(l.mdx)("inlineCode",{parentName:"p"},"SingleValue")," which will be the value that gets modified every block cycle."),Object(l.mdx)("pre",null,Object(l.mdx)("code",{parentName:"pre",className:"language-rust"},"#[pallet::storage]\n#[pallet::getter(fn single_value)]\npub(super) type SingleValue<T: Config> = StorageValue<_, u32, ValueQuery>;\n")),Object(l.mdx)("p",null,"Define your pallet's events:"),Object(l.mdx)("pre",null,Object(l.mdx)("code",{parentName:"pre",className:"language-rust"},"#[pallet::event]\n#[pallet::generate_deposit(pub(super) fn deposit_event)]\npub enum Event<T: Config> {\n    /// The value has ben added to. The parameters are\n    /// (initial amount, amount added, final amount).\n    Added(u32, u32, u32),\n    /// The value has been cleared. The parameter is the value before clearing.\n    Cleared(u32)\n}\n")),Object(l.mdx)("p",null,"Add an error that handles operation overflow:"),Object(l.mdx)("pre",null,Object(l.mdx)("code",{parentName:"pre",className:"language-rust"},"#[pallet::error]\npub enum Error<T> {\n    /// An operation would lead to an overflow.\n    Overflow\n}\n")),Object(l.mdx)("h3",{id:"3-configure-on_finalize"},"3. Configure ",Object(l.mdx)("inlineCode",{parentName:"h3"},"on_finalize")),Object(l.mdx)("p",null,Object(l.mdx)("inlineCode",{parentName:"p"},"SingleValue")," is set to 0 every ",Object(l.mdx)("inlineCode",{parentName:"p"},"ClearFrequency")," number of blocks in the ",Object(l.mdx)("inlineCode",{parentName:"p"},"on_finalize")," function that\nruns at the end of block execution. Specify this logic under the ",Object(l.mdx)("inlineCode",{parentName:"p"},"#[pallet::hooks]")," attribute:"),Object(l.mdx)("pre",null,Object(l.mdx)("code",{parentName:"pre",className:"language-rust"},"#[pallet::hooks]\n    impl<T: Config> Hooks<BlockNumberFor<T>> for Pallet<T> {\n        fn on_finalize(n: T::BlockNumber) {\n            if (n % T::ClearFrequency::get()).is_zero() {\n                let current_value = <SingleValue<T>>::get();\n                <SingleValue<T>>::put(0u32);\n                Self::deposit_event(Event::Cleared(current_value));\n            }\n        }\n    }\n")),Object(l.mdx)("h3",{id:"4-create-a-method-that-allows-users-to-specify-the-value"},"4. Create a method that allows users to specify the value"),Object(l.mdx)("p",null,"The ",Object(l.mdx)("inlineCode",{parentName:"p"},"add_value")," method increases ",Object(l.mdx)("inlineCode",{parentName:"p"},"SingleValue")," so long as each call adds to less than the ",Object(l.mdx)("inlineCode",{parentName:"p"},"MaxAddend")," value."),Object(l.mdx)("p",null,"For this method, make sure to:"),Object(l.mdx)("ul",null,Object(l.mdx)("li",{parentName:"ul"},"Include checks."),Object(l.mdx)("li",{parentName:"ul"},"Keep track of the previous value."),Object(l.mdx)("li",{parentName:"ul"},"Check for overflow."),Object(l.mdx)("li",{parentName:"ul"},"Update ",Object(l.mdx)("inlineCode",{parentName:"li"},"SingleValue"),".")),Object(l.mdx)("pre",null,Object(l.mdx)("code",{parentName:"pre",className:"language-rust"},'    // Extrinsics callable from outside the runtime.\n     #[pallet::call]\n    impl<T: Config> Pallet<T> {\n    #[pallet::weight(1_000)]\n\n    fn add_value(\n        origin: OriginFor<T>,\n        val_to_add: u32\n        ) -> DispatchResultWithPostInfo {\n            let _ = ensure_signed(origin)?;\n\n            ensure!(val_to_add <= T::MaxAddend::get(), "value must be <= maximum add amount constant");\n\n            // previous value got\n            let c_val = SingleValue::<T>::get();\n\n            // checks for overflow when new value added\n            let result = c_val.checked_add(val_to_add).ok_or(Error::<T>::Overflow)?;\n\n            <SingleValue<T>>::put(result);\n            Self::deposit_event(Event::Added(c_val, val_to_add, result));\n            Ok(().into())\n        }\n    }\n')),Object(l.mdx)("h3",{id:"5-supply-the-constant-value-for-runtime"},"5. Supply the constant value for runtime"),Object(l.mdx)("p",null,"In ",Object(l.mdx)("inlineCode",{parentName:"p"},"runtime/src/lib.rs"),", declare the values for your pallet's runtime implementation of ",Object(l.mdx)("inlineCode",{parentName:"p"},"MaxAddend")," and ",Object(l.mdx)("inlineCode",{parentName:"p"},"ClearFrequency"),":"),Object(l.mdx)("pre",null,Object(l.mdx)("code",{parentName:"pre",className:"language-rust"},"parameter_types! {\n    pub const MaxAddend: u32 = 1738;\n    pub const ClearFrequency: u32 = 10;\n}\n\nimpl constant_config::Config for Runtime {\n    type Event = Event;\n    type MaxAddend = MaxAddend;\n    type ClearFrequency = ClearFrequency;\n}\n")),Object(l.mdx)("h2",{id:"examples"},"Examples"),Object(l.mdx)("ul",null,Object(l.mdx)("li",{parentName:"ul"},Object(l.mdx)("a",{parentName:"li",href:"https://github.com/substrate-developer-hub/substrate-how-to-guides/blob/main/example-code/template-node/pallets/configurable-constant/src/lib.rs#L1"},Object(l.mdx)("inlineCode",{parentName:"a"},"constant-config")))),Object(l.mdx)("h2",{id:"resources"},"Resources"),Object(l.mdx)("h4",{id:"tutorials"},"Tutorials"),Object(l.mdx)("ul",null,Object(l.mdx)("li",{parentName:"ul"},Object(l.mdx)("a",{parentName:"li",href:"https://substrate.dev/docs/en/tutorials/forkless-upgrade/"},"Nick's forkless upgrade tutorial"))),Object(l.mdx)("h4",{id:"rust-docs"},"Rust docs"),Object(l.mdx)("ul",null,Object(l.mdx)("li",{parentName:"ul"},Object(l.mdx)("a",{parentName:"li",href:"https://substrate.dev/rustdocs/latest/frame_support/traits/trait.Get.html"},Object(l.mdx)("inlineCode",{parentName:"a"},"Get"))),Object(l.mdx)("li",{parentName:"ul"},Object(l.mdx)("a",{parentName:"li",href:"https://crates.parity.io/frame_support/attr.pallet.html#extra-constants-palletextra_constants-optional"},Object(l.mdx)("inlineCode",{parentName:"a"},"#[pallet::extra_constants]")))))}u.isMDXComponent=!0}}]);